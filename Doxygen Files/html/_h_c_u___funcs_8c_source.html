<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACES HCU: HCU_Funcs.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ACES HCU
   &#160;<span id="projectnumber">1.1.1</span>
   </div>
   <div id="projectbrief">Software for the operation of the Heating Control Unit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_h_c_u___funcs_8c_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">HCU_Funcs.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_h_c_u___funcs_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#define F_CPU 1000000UL   </span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_h_c_u___funcs_8h.html">HCU_Funcs.h</a>&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;avr/io.h&gt;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;util/delay.h&gt;</span>   <span class="comment">// This library is so that easy delay functions can be implemented</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;avr/interrupt.h&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;float.h&gt;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="_h_c_u___funcs_8h.html#a23459ced73501cbafb717ca9cbb10ce7">   38</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_h_c_u___funcs_8c.html#a23459ced73501cbafb717ca9cbb10ce7">Initial</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;{</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// First setup the port directions for the PWM lines and the</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="comment">// 0 are inputs 1 are outputs</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    DDRA = 0b10000000;          <span class="comment">// Only PA7 is an output</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    DDRB = 0b11011010;         </div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    DDRC = 0xFF;                <span class="comment">// Make all outputs</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    DDRD = 0xFF;                <span class="comment">// Make all outputs</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    </div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> = 0;     <span class="comment">// This sets the function mode to heating mode</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#ab5455edceedf93454775e749a89e1014">desired_temp</a> = 0;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#ab752277653bf4ca366fd22ad687edb9a">duty_cycle</a> = (<a class="code" href="_h_c_u___funcs_8h.html#a8f24004cae5e9f858db493e25febf8c8">pump_m</a>*<a class="code" href="_h_c_u___funcs_8h.html#a454e70d560dff1ac5768ca360bf8cb7d">fuelFlow</a> + <a class="code" href="_h_c_u___funcs_8h.html#a355b9fced824741eba5498a7bc74371e">pump_b</a>) / <a class="code" href="_h_c_u___funcs_8h.html#a2a302251d845a16c65382845bf0ce773">pump_tot_V</a>;    <span class="comment">// This is the initial guess for the fuel pump</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    </div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// Now calculate the number of pulses I expect per 0.262144 seconds (max time for an 8 bit timer with prescalar of 1024)</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordtype">float</span> pulse_flow = (<a class="code" href="_h_c_u___funcs_8h.html#a454e70d560dff1ac5768ca360bf8cb7d">fuelFlow</a> / <a class="code" href="_h_c_u___funcs_8h.html#a959f7b5d831006ba86ebf2754975fdfc">density</a>) * <a class="code" href="_h_c_u___funcs_8h.html#a062607eaaffe8c3f8193991755e024f9">K_factor</a> * <a class="code" href="_h_c_u___funcs_8h.html#a0f29307316da99a662028868a7f7636d">max_time</a> / 1000;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#a6cff4477702c9d73bce03b5ae33a9814">desired_pulses</a> = (uint8_t) pulse_flow;                                    <span class="comment">// round down and convert to an 8 bit number.  I expect it to be 170 so it will fit.</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#a2302a051f375379aca3b99b110345408">pulse_error_allow</a> = (uint8_t)(<a class="code" href="_h_c_u___funcs_8h.html#a6cff4477702c9d73bce03b5ae33a9814">desired_pulses</a> * (<a class="code" href="_h_c_u___funcs_8h.html#a96d451028db06887a09ffd9aa864416d">fuelError</a> / <a class="code" href="_h_c_u___funcs_8h.html#a454e70d560dff1ac5768ca360bf8cb7d">fuelFlow</a>));   <span class="comment">// This is the amount of pulses I can be off for it to still be considered a successes</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;MCUCSR,ISC2,1);                                               <span class="comment">// This will cause interrupts for INT2 to be caused on the rising edge</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;GIFR, INTF2, 1);                                              <span class="comment">// Make sure the interrupt flag is cleared</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    </div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    </div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// Configure the ADC</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    ADCSRA |= 1 &lt;&lt; ADPS2;   <span class="comment">// This is so there is a prescalar of 16.  ADC needs frequency between 50-200kHz so 1,000,000/16 puts it in this range.</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    ADCSRA |= 1 &lt;&lt; ADEN;    <span class="comment">// Enable the ADC</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    ADMUX |= 1 &lt;&lt; REFS0;    <span class="comment">// Make AVCC (5V) the reference voltage</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    sei();       <span class="comment">// This sets the global interrupt flag to allow for hardware interrupts</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    </div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// Now enable the timer1 for 0.5 sec</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    TIMSK |= 1 &lt;&lt; TOIE1;                 <span class="comment">// turn on overflow interrupts</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    TCCR1B |= (1&lt;&lt;CS11);                 <span class="comment">// This has a prescalar of 8</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    TCNT1 = 3036;                        <span class="comment">// This will load the value so that when using a prescalar of 8, it will overflow after 500ms</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    </div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[0] = -100.0;        <span class="comment">// Assign initial temperature values that for sure will be colder than the specified temps </span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[1] = -100.0;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[2] = -100.0;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[3] = -100.0;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[4] = -100.0;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[5] = -100.0;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[6] = -100.0; </div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    </div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// Now I need to turn on all of the heaters as well as set the duty cycles for the PWMs which will be on timers 0 and 2</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// Start with the PWM for the ECU, this will be on timer0</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    TCNT0 = 0;      <span class="comment">// Clear the timer register to make sure I have the full range on the first cycle</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0, WGM01, 1);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0, WGM00, 1);      <span class="comment">// These two set the PWM Mode to &quot;Fast PWM&quot;</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0, COM01, 1); </div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0, COM00, 1);      <span class="comment">// These two set the PWM type to inverting PWM</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    </div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    OCR0 = 255 - (255*<a class="code" href="_h_c_u___funcs_8h.html#a5771c39b4bd816a79ea85d2cf49e54e1">ECU_duty</a>);       <span class="comment">// This will set it to the specified duty by the #define</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    </div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    TCCR0 |= (1 &lt;&lt; CS02);              <span class="comment">// This will start the PWM with a duty cycle of 65.536 ms</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    </div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">// Now do the PWM for the second fuel line which will use Timer 2,  this will look very similar to the last few lines of code</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    TCNT2 = 0;      <span class="comment">// Clear the timer register to make sure I have the full range on the first cycle</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR2, WGM21, 1);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR2, WGM20, 1);      <span class="comment">// These two set the PWM Mode to &quot;Fast PWM&quot;</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR2, COM21, 1);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR2, COM20, 1);      <span class="comment">// These two set the PWM type to inverting PWM</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        </div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    OCR2 = 255 - (255*<a class="code" href="_h_c_u___funcs_8h.html#ad79edaf8e30d1447ae96c9d3ad6ebe92">F_line_duty</a>);    <span class="comment">// This will set it to the specified duty by the #define</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        </div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    TCCR2 |= (1 &lt;&lt; CS22);              <span class="comment">// This will start the PWM with a duty cycle of 65.536 ms, just like before</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    </div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">// Now turn on all the other heaters</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a3919bd4c0b60bf3018c0b906d7a8a6f3">BatPin</a>, 1);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#aa06a4797a5fae497bf0913c244596252">HopperPin</a>, 1);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a88feb1e24e14c8ff294150b850cb7409">FLine1Pin</a>, 1);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a733a247e26e9f5a70da6513349f63785">ESB_Pin</a>, 1);     <span class="comment">// I can omit doing this for the ECU and FuelLine1</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        </div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;}</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="_h_c_u___funcs_8c.html#ab16889ae984b9b798989a0d239283cac">  123</a></span>&#160;<a class="code" href="_h_c_u___funcs_8c.html#ab16889ae984b9b798989a0d239283cac">ISR</a>(TIMER1_OVF_vect)</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;{</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// The LED is on PD5</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a>++;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a> % 2 == 1)</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        PORTD ^= (1 &lt;&lt; <a class="code" href="_h_c_u___funcs_8h.html#a3acbc6965c0aef6489e220b6b4381956">Alive_LED</a>);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        </div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    PORTB ^= (1 &lt;&lt; <a class="code" href="_h_c_u___funcs_8h.html#a9f877a9f91f3f250db97a58abe796eb9">Warm_LED</a>);   <span class="comment">// This will have the warming LED blink 0.5 sec on 0.5 sec off and the alive LED blinking twice as slow</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    </div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// Now reset the register</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    TCNT1 = 3036;  <span class="comment">// The interrupt will clear automatically when this function is called</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;}</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="_h_c_u___funcs_8h.html#ab42f8654f10b780bd735bb55bd53d60d">  155</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_h_c_u___funcs_8c.html#ab42f8654f10b780bd735bb55bd53d60d">tempConversion</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;{</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// First check if the ADC is done converting</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;ADMUX,MUX0,0);    <span class="comment">// Assign channel to 0</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;ADMUX,MUX1,0);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;ADMUX,MUX2,0);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    </div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i = 0; i &lt; 6; i++)</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        ADCSRA |= 1 &lt;&lt; ADSC;                             <span class="comment">// Start the conversion</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordflow">while</span> (!((1 &lt;&lt; ADIF) &amp; ADCSRA));</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        </div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="_h_c_u___funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a>(ADCSRA, ADIF));              <span class="comment">// Hog execution until the ADC is done converting</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="comment">// Save this as a float for the respective variable</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        uint8_t low_bits = ADCL;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        uint8_t high_bits = ADCH;                        <span class="comment">// Do the shifting so that there is room made inside of the 16 bit register</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        uint16_t result = (high_bits &lt;&lt; 8) | low_bits;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        </div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="comment">// Now I need to convert this 16 bit number into an actual temperature</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        </div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordtype">float</span> act_temp = (float)(0.0048828125*result);   <span class="comment">// This dumb thing converts it to a voltage</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        act_temp = act_temp*208.8 - 79.6;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[i] = act_temp;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        </div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment">// Now update the channel the ADC is using</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;ADMUX,MUX0,(i + 1) &amp; 0x01);           <span class="comment">// Assign bit 0</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;ADMUX,MUX1,((i + 1) &gt;&gt; 1) &amp; 0x01);    <span class="comment">// Assign bit 1</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;ADMUX,MUX2,((i + 1) &gt;&gt; 2) &amp; 0x01);    <span class="comment">// Assign bit 2</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        </div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;ADCSRA, ADIF, 1);     <span class="comment">// write a logical 1 to clear the flag, page 216 in the data sheet</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#a7eb1892912f647fc11a82891ac8b0408">tempHeaterHelper</a>();             <span class="comment">// Call the helper function.  This will serve the added bonus of killing some time so that if capacitors need to charge for the next conversion, it has the time here.  Data sheet didn&#39;t say that it needed this though.</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> != 1)</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        _delay_ms(250);                 <span class="comment">// Delay for 1/4 of a second.   This will only impact modes 0 and 2</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    </div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;}</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno"><a class="line" href="_h_c_u___funcs_8h.html#a7eb1892912f647fc11a82891ac8b0408">  213</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_h_c_u___funcs_8c.html#a7eb1892912f647fc11a82891ac8b0408">tempHeaterHelper</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;{</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; 6; i++)</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">switch</span>(i){</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            <span class="keywordflow">case</span> 0:                             <span class="comment">// This is the case for the Lipo batteries   //////////////////////////////////////////////</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[0] &gt; <a class="code" href="_h_c_u___funcs_8h.html#a4a986a3de3a6d57316476093798ab1ec">TempBat</a> )    <span class="comment">// safety first so make sure that the temperature always turns off if one of the batteries is getting too hot</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                    <a class="code" href="_h_c_u___funcs_8h.html#ab5455edceedf93454775e749a89e1014">desired_temp</a> |= 0x01;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a3919bd4c0b60bf3018c0b906d7a8a6f3">BatPin</a>, 0);       <span class="comment">// Turn the heater off if either of these get too high</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                }</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[0] &lt; <a class="code" href="_h_c_u___funcs_8h.html#a4a986a3de3a6d57316476093798ab1ec">TempBat</a>)</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a3919bd4c0b60bf3018c0b906d7a8a6f3">BatPin</a>, 1);    <span class="comment">// Turn the heater back on to warm them up</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                </div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <span class="keywordflow">case</span> 1:       <span class="comment">// This is the case for the Hopper    /////////////////////////////////////////////////</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[2] &lt; <a class="code" href="_h_c_u___funcs_8h.html#a0b5ab129139e036dc4806dafa6334356">TempHopper</a>)           <span class="comment">// Temp is too low so turn on the heater</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#aa06a4797a5fae497bf0913c244596252">HopperPin</a>, 1);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[2] &gt; <a class="code" href="_h_c_u___funcs_8h.html#a0b5ab129139e036dc4806dafa6334356">TempHopper</a>)</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                {</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#aa06a4797a5fae497bf0913c244596252">HopperPin</a>, 0);    <span class="comment">// Too hot so turn off</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                    <a class="code" href="_h_c_u___funcs_8h.html#ab5455edceedf93454775e749a89e1014">desired_temp</a> |= 0x02;               </div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                </div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="keywordflow">case</span> 2:       <span class="comment">// This is the case for the ECU  /////////////////////////////////////////////////</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[3] &lt; <a class="code" href="_h_c_u___funcs_8h.html#a0503d717a5ccf7e169fa912de286ad28">TempECU</a>)</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                    <span class="keywordflow">if</span> (!<a class="code" href="_h_c_u___funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a>)</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0, CS02, 1);      <span class="comment">// This will turn the PWM back on</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTB, <a class="code" href="_h_c_u___funcs_8h.html#abcbfe8a707a6fdd65fb7ba622bdbf93b">ECU_pin</a>, 1);   <span class="comment">// Turn the heater on manually</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[3] &gt; <a class="code" href="_h_c_u___funcs_8h.html#a0503d717a5ccf7e169fa912de286ad28">TempECU</a>)</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                {</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                    <span class="keywordflow">if</span> (!<a class="code" href="_h_c_u___funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a>)</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                    {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0, CS02, 0);      <span class="comment">// This will turn the PWM off</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                        <a class="code" href="_h_c_u___funcs_8h.html#ab5455edceedf93454775e749a89e1014">desired_temp</a> |= 0x04;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                    }</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTB, <a class="code" href="_h_c_u___funcs_8h.html#abcbfe8a707a6fdd65fb7ba622bdbf93b">ECU_pin</a>, 0);   <span class="comment">// Turn the heater off manually.  Don&#39;t do the same thing with desired_temp for the manual mode</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                </div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <span class="keywordflow">case</span> 3:       <span class="comment">// This is the case for Fuel Line 1  /////////////////////////////////////////////////</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[4] &lt; <a class="code" href="_h_c_u___funcs_8h.html#ae379e3fb4b72cee7e07f0ef6a89ea474">TempFLine1</a>)</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a88feb1e24e14c8ff294150b850cb7409">FLine1Pin</a>, 1);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[4] &gt; <a class="code" href="_h_c_u___funcs_8h.html#ae379e3fb4b72cee7e07f0ef6a89ea474">TempFLine1</a>)</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a88feb1e24e14c8ff294150b850cb7409">FLine1Pin</a>, 0);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                    <a class="code" href="_h_c_u___funcs_8h.html#ab5455edceedf93454775e749a89e1014">desired_temp</a> |= 0x08;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                }</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                </div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="keywordflow">case</span> 4:       <span class="comment">// This is the case for Fuel Line 2 /////////////////////////////////////////////////</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[5] &lt; <a class="code" href="_h_c_u___funcs_8h.html#a83fa1def7c7b1f50dc6c81cbc4d283d0">TempFLine2</a>){</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                    <span class="keywordflow">if</span> (!<a class="code" href="_h_c_u___funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a>)      <span class="comment">// We are in the warming mode so this can use the PWM</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR2, CS22, 1);          <span class="comment">// Turn the PWM back on </span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD,<a class="code" href="_h_c_u___funcs_8h.html#aca3168372614244d98d74b54e6b89a26">Fline2Pin</a>,1);       <span class="comment">// Turn the heater on manually</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[5] &gt; <a class="code" href="_h_c_u___funcs_8h.html#a83fa1def7c7b1f50dc6c81cbc4d283d0">TempFLine2</a>)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                    <span class="keywordflow">if</span> (!<a class="code" href="_h_c_u___funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a>)           <span class="comment">// We are in warming mode so this can use the PWM</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                    {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR2, CS22, 0);       <span class="comment">// Turn the PWM off</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                        <a class="code" href="_h_c_u___funcs_8h.html#ab5455edceedf93454775e749a89e1014">desired_temp</a> |= 0x10;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                    }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#aca3168372614244d98d74b54e6b89a26">Fline2Pin</a>, 0);    <span class="comment">// Turn the heater off manually</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                </div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <span class="keywordflow">case</span> 5:       <span class="comment">// This is the case for the ESB    /////////////////////////////////////////////////</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[5] &lt; <a class="code" href="_h_c_u___funcs_8h.html#aba6f077d1dbb43111eed2e8f4a2540a6">TempESB</a>)</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a733a247e26e9f5a70da6513349f63785">ESB_Pin</a>, 1);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a>[5] &gt; <a class="code" href="_h_c_u___funcs_8h.html#aba6f077d1dbb43111eed2e8f4a2540a6">TempESB</a>)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a733a247e26e9f5a70da6513349f63785">ESB_Pin</a>, 0);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                    <a class="code" href="_h_c_u___funcs_8h.html#ab5455edceedf93454775e749a89e1014">desired_temp</a> |= 0x20;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                }</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        </div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    </div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#ab5455edceedf93454775e749a89e1014">desired_temp</a> == 0x3F)      <span class="comment">// Will go in here every time after it stops being mode 0</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="comment">/* If desired_temp was 0111 1111, it would go to 1111 1111 with the or.</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">        *   Then the bitwise not (~) would make it 0000 0000.  And finally,</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">        *   the logical not (!) would make it 0000 0001 and it would go into the if statement.</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">        *   If desired_temp is anything but this, it will not go in here </span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="_h_c_u___funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a>)    <span class="comment">// only do this if it has never gone in here before</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <a class="code" href="_h_c_u___funcs_8c.html#af224025ba48225a48fc9eddc2e72150d">change_timers</a>();                     <span class="comment">// New initialization routine which will change the prescalars and such for the timers which will be serving different purposes</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;}</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno"><a class="line" href="_h_c_u___funcs_8h.html#a560b1b76f46bf0b687417029801fd05a">  330</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_h_c_u___funcs_8c.html#a560b1b76f46bf0b687417029801fd05a">flowMeter</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;{</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">// First I need to enable interrupt on INT2</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#af9e36069f73b8a3642ae276fd3b672a1">pulse_count</a> = 0;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    GICR |= (1 &lt;&lt; INT2);     <span class="comment">// enable INT2 external interrupts</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    </div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">// Second I need to begin timer0</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    TCNT0 = 0;                                 <span class="comment">// Make sure the timer/counter register is cleared so the full range can be used</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TIFR,TOV1,1);                  <span class="comment">// Make sure the overflow flag is set</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0,CS02,1);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0,CS01,0);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0,CS00,1);                 <span class="comment">// TThis will start the timer with a prescalar of 1024</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    </div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">while</span> (!(TIFR &amp; 0x01));                    <span class="comment">// Hog the execution until the overflow flag is set</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    </div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;GICR, INT2, 0);                <span class="comment">// disable external interrupts for INT2</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        </div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="_h_c_u___funcs_8h.html#af9e36069f73b8a3642ae276fd3b672a1">pulse_count</a>)                          <span class="comment">// There is either no more fuel or there is a stoppage.  This if statement might be the end of me...</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    {</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <a class="code" href="_h_c_u___funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> = 2;                            <span class="comment">//  This means that the pumping has concluded</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR1B, CS10, 0);          <span class="comment">// This should stop the PWM for the pump</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a8ad8cee6932a1598468451a573827467">Fuel_LED</a>, 1);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        TCNT2 = 60;                               <span class="comment">// Value needed for the timer to run for 0.05 second</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a3acbc6965c0aef6489e220b6b4381956">Alive_LED</a>, 1);         <span class="comment">// Start with turning on the LED</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <a class="code" href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a> = 0;                        <span class="comment">// reset the hand made prescalar</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        TCCR2 = 0x06;                             <span class="comment">// This will start the Timer with a prescalar of 256 and stop the PWM stuff</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        </div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    }</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    {</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="comment">// Now I need to compare the number of pulses I got with what I should have received</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        int8_t pulse_error = <a class="code" href="_h_c_u___funcs_8h.html#a6cff4477702c9d73bce03b5ae33a9814">desired_pulses</a> - <a class="code" href="_h_c_u___funcs_8h.html#af9e36069f73b8a3642ae276fd3b672a1">pulse_count</a>;   <span class="comment">// This will be able to handle negative numbers</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordtype">float</span> change = (float) pulse_error * <a class="code" href="_h_c_u___funcs_8h.html#af6df0f502576f1240a2c274a4b3e8aaf">V_per_pulse</a> * ((<span class="keywordtype">float</span>) ICR1) / <a class="code" href="_h_c_u___funcs_8h.html#a2a302251d845a16c65382845bf0ce773">pump_tot_V</a>;   <span class="comment">// Check page 94 in notebook for correct derivation.</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        OCR1B -= (uint16_t) change;   </div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="comment">// The above line should immediately change the PWM as well</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        </div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keywordflow">if</span> (pulse_error &lt; 0)</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            pulse_error = -pulse_error;          <span class="comment">// Make it the absolute value </span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">if</span> (pulse_error &lt;= <a class="code" href="_h_c_u___funcs_8h.html#a2302a051f375379aca3b99b110345408">pulse_error_allow</a>)    <span class="comment">// mission is a success</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            PORTD |= (1 &lt;&lt; <a class="code" href="_h_c_u___funcs_8h.html#a8ad8cee6932a1598468451a573827467">Fuel_LED</a>);            <span class="comment">// Make the fuel LED just stay on</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            PORTD ^= (1 &lt;&lt; <a class="code" href="_h_c_u___funcs_8h.html#a8ad8cee6932a1598468451a573827467">Fuel_LED</a>);            <span class="comment">// Make the fuel LED blink saying that it is not done yet.</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    </div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;}</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno"><a class="line" href="_h_c_u___funcs_8h.html#ae058494623946a8ea13c1cdb69082dd3">  381</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_h_c_u___funcs_8c.html#ae058494623946a8ea13c1cdb69082dd3">ECU_toggle</a>(uint8_t ECU_mode)</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;{</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTA, <a class="code" href="_h_c_u___funcs_8h.html#a3c89094d4fdcd1aacfb42efac1926ec4">ECUon_Pin</a>, ECU_mode);   <span class="comment">// make sure the ECU has its power circuit closed if it is an operational ECU</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;}</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno"><a class="line" href="_h_c_u___funcs_8h.html#aba7fa75d6dd6ebcdc6225282a798fcd2">  393</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(<span class="keyword">volatile</span> uint8_t *sfr,uint8_t bit, uint8_t val)</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;{</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordflow">if</span> (val)      <span class="comment">// This is for if I want the value to be a 1</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        val = (val &lt;&lt; bit);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        *sfr |= val;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    }</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">else</span>             <span class="comment">// This is for if I want the value to be a 0</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    {</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        val = ~(1 &lt;&lt; bit);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        *sfr &amp;= val;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    }</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;}</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00424"></a><span class="lineno"><a class="line" href="_h_c_u___funcs_8h.html#af224025ba48225a48fc9eddc2e72150d">  424</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_h_c_u___funcs_8c.html#af224025ba48225a48fc9eddc2e72150d">change_timers</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;{</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> = 1;                          <span class="comment">// Change the operational mode</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTB,<a class="code" href="_h_c_u___funcs_8h.html#a9f877a9f91f3f250db97a58abe796eb9">Warm_LED</a>,1);    <span class="comment">// Turn on the LED to signal the heating sequence is complete</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <a class="code" href="_h_c_u___funcs_8c.html#ae058494623946a8ea13c1cdb69082dd3">ECU_toggle</a>(<a class="code" href="_h_c_u___funcs_8h.html#ad929acd64f5f96d83c219733e25e7a29">ECU_present</a>);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    </div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="comment">// Now need to assign timer 2 to the alive LED</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    </div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="_h_c_u___funcs_8h.html#ad929acd64f5f96d83c219733e25e7a29">ECU_present</a>)</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    {</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="comment">// First change Timer 1 to serve as the PWM output port for the pump</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TIMSK,TOIE1,0);    <span class="comment">// remove overflow interrupts for timer 1</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        TCCR1A |= (1 &lt;&lt; WGM11);     <span class="comment">// The sets one of the bits for the mode 14 waveform</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        TCCR1B |= (1 &lt;&lt; WGM12) | (1 &lt;&lt; WGM13);   <span class="comment">// This sets the other two bits for the waveform generation</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        TCCR1A |= (1 &lt;&lt; COM1B1) | (1 &lt;&lt; COM1B0);   <span class="comment">// These set the output mode</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        ICR1 = 20000;     <span class="comment">// this will set the period of oscillation to 20ms</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            </div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        OCR1B = ICR1 - (int)(ICR1*<a class="code" href="_h_c_u___funcs_8h.html#ab752277653bf4ca366fd22ad687edb9a">duty_cycle</a>);     <span class="comment">// This will set the count at which the PWM will change to on. Also make sure to round down to int</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR1B, CS10, 1);              <span class="comment">// This should start the PWM with a prescalar of 1</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="comment">// Now the PWM should be running</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            </div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="comment">// Second change Timer0 to serve as the counter for the pulse train from the flow meter</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        TCCR0 = 0;                                 <span class="comment">// Turn off the PWM so the ECU stops being warmed</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0,CS02,0);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0,CS01,0);</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;TCCR0,CS00,0);                 <span class="comment">// TThis will make sure that the timer is stopped for now    </span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        </div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="comment">// Third set the MCU Control and Status Register for the Interrupt Sense Control 2</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        MCUCSR |= (1 &lt;&lt; ISC2);                    <span class="comment">// This will make interrupts occur on the rising edge, so the beginning of the pulse</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        </div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="comment">// Fourth set Timer2 for the 0.75/0.25 second blink of the Alive LED</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a3acbc6965c0aef6489e220b6b4381956">Alive_LED</a>, 1);         <span class="comment">// Start with turning on the LED</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        TIMSK |= (1 &lt;&lt; TOIE2);                    <span class="comment">// Enable overflow interrupts on the timer</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        TCNT2 = 11;                               <span class="comment">// This is the value needed for the timer to run for 0.25 seconds</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <a class="code" href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a> = 0;                        <span class="comment">// Reset the hand made prescalar</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        TCCR2 = 0x07;                             <span class="comment">// Start the timer with a prescalar of 1024</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        </div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    }</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">else</span>           <span class="comment">// We are directly skipping the pumping phase so just set up the 0.1/0.9 second blink and turn on the pumping light</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <a class="code" href="_h_c_u___funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> = 2;                               <span class="comment">// Change to the Exhaustion Mode</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a8ad8cee6932a1598468451a573827467">Fuel_LED</a>, 1);          <span class="comment">// turn on the fuel LED</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        </div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="comment">// Now I need to set up Timer2 for the Alive LED</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        TIMSK |= (1 &lt;&lt; TOIE2);                    <span class="comment">// Enable overflow interrupts on the timer</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        TCNT2 = 60;                               <span class="comment">// Value needed for the timer to run for 0.05 second</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a3acbc6965c0aef6489e220b6b4381956">Alive_LED</a>, 1);         <span class="comment">// Start with turning on the LED</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <a class="code" href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a> = 0;                        <span class="comment">// reset the hand made prescalar</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        TCCR2 = 0x06;                             <span class="comment">// This will start the Timer with a prescalar of 256 and stop the PWM stuff</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        </div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="comment">// now remove the other PWMS</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        TCCR0 = 0;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        TCCR1B = 0;         <span class="comment">// This set is to prevent any unexpected triggering of the heating circuits</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        TCCR1A = 0;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        </div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        </div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    }</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;}</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno"><a class="line" href="_h_c_u___funcs_8c.html#a30a0ad88a89a84c0161cf09eace108e8">  490</a></span>&#160;<a class="code" href="_h_c_u___funcs_8c.html#ab16889ae984b9b798989a0d239283cac">ISR</a>(INT2_vect)</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;{</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <a class="code" href="_h_c_u___funcs_8h.html#af9e36069f73b8a3642ae276fd3b672a1">pulse_count</a>++;  <span class="comment">// The interrupt flag will automatically be cleared by hardware</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;}</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno"><a class="line" href="_h_c_u___funcs_8c.html#a7cfcbe42bd266750aeb6e5d71e5ea479">  509</a></span>&#160;<a class="code" href="_h_c_u___funcs_8c.html#ab16889ae984b9b798989a0d239283cac">ISR</a>(TIMER2_OVF_vect)</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;{</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a> == 1)     <span class="comment">// Operation mode 1 so do 0.75 sec on and 0.25 sec off</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a> == 2)</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        {</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a3acbc6965c0aef6489e220b6b4381956">Alive_LED</a>, 0);        <span class="comment">// Turn the LED off since it is at the end of the 0.75 sec portion</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <a class="code" href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a>++;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            TCNT2 = 11;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a> == 3)</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a3acbc6965c0aef6489e220b6b4381956">Alive_LED</a>, 1);        <span class="comment">// Turn the LED back on since it is about to begin the 0.75 second portion</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <a class="code" href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a> = 0;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            TCNT2 = 11;                              <span class="comment">// Assign the correct value into the Timer register so that it goes for 0.25 sec</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="keywordflow">else</span>                                         <span class="comment">// This section is for if it is in the middle of the 0.75 sec portion</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        {</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            <a class="code" href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a>++;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            TCNT2 = 11;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        }</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    }</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">else</span>   <span class="comment">// I am in operation mode 2 so I need to do 0.1 sec on 0.9 sec off</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a> == 1)</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a3acbc6965c0aef6489e220b6b4381956">Alive_LED</a>, 0);            <span class="comment">// Turn off the LED since we are at the end of the 0.1 sec period</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            <a class="code" href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a>++;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            TCNT2 = 60;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a> == 19)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        {</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            <a class="code" href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a>(&amp;PORTD, <a class="code" href="_h_c_u___funcs_8h.html#a3acbc6965c0aef6489e220b6b4381956">Alive_LED</a>, 1);            <span class="comment">// Turn on the LED since we are at the end of the 0.9 sec period</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            <a class="code" href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a> = 0;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            TCNT2 = 60;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        }</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        {</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            <a class="code" href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a>++;                             <span class="comment">// At one of the intermediate points so just keep the LED how it is</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            TCNT2 = 60; </div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        }</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    }</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;}</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="ttc" id="_h_c_u___funcs_8h_html_a2302a051f375379aca3b99b110345408"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a2302a051f375379aca3b99b110345408">pulse_error_allow</a></div><div class="ttdeci">uint8_t pulse_error_allow</div><div class="ttdoc">Most amount of error in the difference in the pulse amounts to be considered a success. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00165">HCU_Funcs.h:165</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a6cff4477702c9d73bce03b5ae33a9814"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a6cff4477702c9d73bce03b5ae33a9814">desired_pulses</a></div><div class="ttdeci">uint8_t desired_pulses</div><div class="ttdoc">Number of pulse which should be observed during the 8 bit timing window. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00162">HCU_Funcs.h:162</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_ab1fa4bbd357586cbfa309f1b8614c1ae"><div class="ttname"><a href="_h_c_u___funcs_8h.html#ab1fa4bbd357586cbfa309f1b8614c1ae">opMode</a></div><div class="ttdeci">char opMode</div><div class="ttdoc">Operational mode the system is in. 0 for heating, 1 for pumping, 2 for pumping has finished...</div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00150">HCU_Funcs.h:150</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_ab752277653bf4ca366fd22ad687edb9a"><div class="ttname"><a href="_h_c_u___funcs_8h.html#ab752277653bf4ca366fd22ad687edb9a">duty_cycle</a></div><div class="ttdeci">float duty_cycle</div><div class="ttdoc">Value of the duty cycle in 0.XXXX. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00153">HCU_Funcs.h:153</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a733a247e26e9f5a70da6513349f63785"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a733a247e26e9f5a70da6513349f63785">ESB_Pin</a></div><div class="ttdeci">#define ESB_Pin</div><div class="ttdoc">Pin location for the ESB heating circuit. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00091">HCU_Funcs.h:91</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a55274be3d823eb7a4bf281eaa3e74d4a"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a55274be3d823eb7a4bf281eaa3e74d4a">alive_counter</a></div><div class="ttdeci">uint8_t alive_counter</div><div class="ttdoc">Variable to delay the alive_led so that it blinks twice as slow as the warming LED. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00171">HCU_Funcs.h:171</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_ab5455edceedf93454775e749a89e1014"><div class="ttname"><a href="_h_c_u___funcs_8h.html#ab5455edceedf93454775e749a89e1014">desired_temp</a></div><div class="ttdeci">unsigned char desired_temp</div><div class="ttdoc">Byte which will flip bits 0-7 to denote when each component has reached its desired temp...</div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00159">HCU_Funcs.h:159</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a0503d717a5ccf7e169fa912de286ad28"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a0503d717a5ccf7e169fa912de286ad28">TempECU</a></div><div class="ttdeci">#define TempECU</div><div class="ttdoc">Desired temperature of the ECU in degF (ADC3) </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00044">HCU_Funcs.h:44</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8c_html_aba7fa75d6dd6ebcdc6225282a798fcd2"><div class="ttname"><a href="_h_c_u___funcs_8c.html#aba7fa75d6dd6ebcdc6225282a798fcd2">assign_bit</a></div><div class="ttdeci">void assign_bit(volatile uint8_t *sfr, uint8_t bit, uint8_t val)</div><div class="ttdoc">Sets the specified bit to the specified value or does nothing if it already set to that...</div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8c_source.html#l00393">HCU_Funcs.c:393</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_abcbfe8a707a6fdd65fb7ba622bdbf93b"><div class="ttname"><a href="_h_c_u___funcs_8h.html#abcbfe8a707a6fdd65fb7ba622bdbf93b">ECU_pin</a></div><div class="ttdeci">#define ECU_pin</div><div class="ttdoc">Pin location for the ECU heater circuit output. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00074">HCU_Funcs.h:74</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a4a986a3de3a6d57316476093798ab1ec"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a4a986a3de3a6d57316476093798ab1ec">TempBat</a></div><div class="ttdeci">#define TempBat</div><div class="ttdoc">Desired temperature of the lipo batteries in degF (ADC0) </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00038">HCU_Funcs.h:38</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a2a302251d845a16c65382845bf0ce773"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a2a302251d845a16c65382845bf0ce773">pump_tot_V</a></div><div class="ttdeci">#define pump_tot_V</div><div class="ttdoc">Total voltage which will be sent to the pump. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00122">HCU_Funcs.h:122</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a5771c39b4bd816a79ea85d2cf49e54e1"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a5771c39b4bd816a79ea85d2cf49e54e1">ECU_duty</a></div><div class="ttdeci">#define ECU_duty</div><div class="ttdoc">Duty cycle for the ECU heater (0.5 = 50%) </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00128">HCU_Funcs.h:128</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8c_html_a560b1b76f46bf0b687417029801fd05a"><div class="ttname"><a href="_h_c_u___funcs_8c.html#a560b1b76f46bf0b687417029801fd05a">flowMeter</a></div><div class="ttdeci">void flowMeter(void)</div><div class="ttdoc">Reads/times the pulse train coming from the flow meter and passes this to pumpOperation. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8c_source.html#l00330">HCU_Funcs.c:330</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a96d451028db06887a09ffd9aa864416d"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a96d451028db06887a09ffd9aa864416d">fuelError</a></div><div class="ttdeci">#define fuelError</div><div class="ttdoc">Acceptable error in terms of g/sec. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00035">HCU_Funcs.h:35</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a88feb1e24e14c8ff294150b850cb7409"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a88feb1e24e14c8ff294150b850cb7409">FLine1Pin</a></div><div class="ttdeci">#define FLine1Pin</div><div class="ttdoc">Pin location for the heating circuit for the first section of the fuel line. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00088">HCU_Funcs.h:88</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html"><div class="ttname"><a href="_h_c_u___funcs_8h.html">HCU_Funcs.h</a></div><div class="ttdoc">Function prototypes, macros, constants, and global variables for the HCU Microcontroller. </div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a60c744c09c8dbe9ea1233ba22b158d7d"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a60c744c09c8dbe9ea1233ba22b158d7d">saveTemps</a></div><div class="ttdeci">float saveTemps[6]</div><div class="ttdoc">Array of the six temperatures we are keeping track of. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00156">HCU_Funcs.h:156</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a3acbc6965c0aef6489e220b6b4381956"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a3acbc6965c0aef6489e220b6b4381956">Alive_LED</a></div><div class="ttdeci">#define Alive_LED</div><div class="ttdoc">Pin location for the Alive LED. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00094">HCU_Funcs.h:94</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a8f24004cae5e9f858db493e25febf8c8"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a8f24004cae5e9f858db493e25febf8c8">pump_m</a></div><div class="ttdeci">#define pump_m</div><div class="ttdoc">Slope for the linear relationship between voltage and mass flow (put in mf, get volts) ...</div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00116">HCU_Funcs.h:116</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a959f7b5d831006ba86ebf2754975fdfc"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a959f7b5d831006ba86ebf2754975fdfc">density</a></div><div class="ttdeci">#define density</div><div class="ttdoc">Density of the kerosene in g/ml. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00110">HCU_Funcs.h:110</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_aca3168372614244d98d74b54e6b89a26"><div class="ttname"><a href="_h_c_u___funcs_8h.html#aca3168372614244d98d74b54e6b89a26">Fline2Pin</a></div><div class="ttdeci">#define Fline2Pin</div><div class="ttdoc">Pin location for the heating circuit for the second section of the fuel line. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00100">HCU_Funcs.h:100</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a3919bd4c0b60bf3018c0b906d7a8a6f3"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a3919bd4c0b60bf3018c0b906d7a8a6f3">BatPin</a></div><div class="ttdeci">#define BatPin</div><div class="ttdoc">Pin location for the Lipo Battery heating circuit. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00082">HCU_Funcs.h:82</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_aba6f077d1dbb43111eed2e8f4a2540a6"><div class="ttname"><a href="_h_c_u___funcs_8h.html#aba6f077d1dbb43111eed2e8f4a2540a6">TempESB</a></div><div class="ttdeci">#define TempESB</div><div class="ttdoc">Desired temperature of the ESB in degF (ADC6) </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00053">HCU_Funcs.h:53</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_ad79edaf8e30d1447ae96c9d3ad6ebe92"><div class="ttname"><a href="_h_c_u___funcs_8h.html#ad79edaf8e30d1447ae96c9d3ad6ebe92">F_line_duty</a></div><div class="ttdeci">#define F_line_duty</div><div class="ttdoc">Duty cycle for the second fuel line heater. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00131">HCU_Funcs.h:131</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a454e70d560dff1ac5768ca360bf8cb7d"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a454e70d560dff1ac5768ca360bf8cb7d">fuelFlow</a></div><div class="ttdeci">#define fuelFlow</div><div class="ttdoc">Desired mass flow rate of fuel in g/sec. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00032">HCU_Funcs.h:32</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_ae379e3fb4b72cee7e07f0ef6a89ea474"><div class="ttname"><a href="_h_c_u___funcs_8h.html#ae379e3fb4b72cee7e07f0ef6a89ea474">TempFLine1</a></div><div class="ttdeci">#define TempFLine1</div><div class="ttdoc">Desired temperature of the fuel line to the pump in degF (ADC4) </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00047">HCU_Funcs.h:47</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a0f29307316da99a662028868a7f7636d"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a0f29307316da99a662028868a7f7636d">max_time</a></div><div class="ttdeci">#define max_time</div><div class="ttdoc">Maximum amount of time for an 8 bit timer with a prescalar of 1024. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00113">HCU_Funcs.h:113</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a355b9fced824741eba5498a7bc74371e"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a355b9fced824741eba5498a7bc74371e">pump_b</a></div><div class="ttdeci">#define pump_b</div><div class="ttdoc">Y-intercept for the linear relationship between voltage and mass flow. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00119">HCU_Funcs.h:119</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8c_html_ab42f8654f10b780bd735bb55bd53d60d"><div class="ttname"><a href="_h_c_u___funcs_8c.html#ab42f8654f10b780bd735bb55bd53d60d">tempConversion</a></div><div class="ttdeci">void tempConversion(void)</div><div class="ttdoc">Check for the completion of the ADC conversion, saves the result, and changes the channel...</div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8c_source.html#l00155">HCU_Funcs.c:155</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8c_html_a7eb1892912f647fc11a82891ac8b0408"><div class="ttname"><a href="_h_c_u___funcs_8c.html#a7eb1892912f647fc11a82891ac8b0408">tempHeaterHelper</a></div><div class="ttdeci">void tempHeaterHelper(void)</div><div class="ttdoc">Checks the recorded temperatures and ensures there is no overheating. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8c_source.html#l00213">HCU_Funcs.c:213</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a0b5ab129139e036dc4806dafa6334356"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a0b5ab129139e036dc4806dafa6334356">TempHopper</a></div><div class="ttdeci">#define TempHopper</div><div class="ttdoc">Desired temperature of the hopper in degF (ADC2) </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00041">HCU_Funcs.h:41</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a83fa1def7c7b1f50dc6c81cbc4d283d0"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a83fa1def7c7b1f50dc6c81cbc4d283d0">TempFLine2</a></div><div class="ttdeci">#define TempFLine2</div><div class="ttdoc">Desired temperature of the fuel line to the engine in degF (ADC5) </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00050">HCU_Funcs.h:50</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8c_html_a23459ced73501cbafb717ca9cbb10ce7"><div class="ttname"><a href="_h_c_u___funcs_8c.html#a23459ced73501cbafb717ca9cbb10ce7">Initial</a></div><div class="ttdeci">void Initial(void)</div><div class="ttdoc">Initializes the microcontroller for its mainline execution. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8c_source.html#l00038">HCU_Funcs.c:38</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_aa06a4797a5fae497bf0913c244596252"><div class="ttname"><a href="_h_c_u___funcs_8h.html#aa06a4797a5fae497bf0913c244596252">HopperPin</a></div><div class="ttdeci">#define HopperPin</div><div class="ttdoc">Pin location for the Hopper heating circuit. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00085">HCU_Funcs.h:85</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_af6df0f502576f1240a2c274a4b3e8aaf"><div class="ttname"><a href="_h_c_u___funcs_8h.html#af6df0f502576f1240a2c274a4b3e8aaf">V_per_pulse</a></div><div class="ttdeci">#define V_per_pulse</div><div class="ttdoc">Volts required to get a single change in pulse count. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00125">HCU_Funcs.h:125</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8c_html_ae058494623946a8ea13c1cdb69082dd3"><div class="ttname"><a href="_h_c_u___funcs_8c.html#ae058494623946a8ea13c1cdb69082dd3">ECU_toggle</a></div><div class="ttdeci">void ECU_toggle(uint8_t ECU_mode)</div><div class="ttdoc">Checks if the ECU power circuit is closed and if it is not, it opens it. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8c_source.html#l00381">HCU_Funcs.c:381</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8c_html_ab16889ae984b9b798989a0d239283cac"><div class="ttname"><a href="_h_c_u___funcs_8c.html#ab16889ae984b9b798989a0d239283cac">ISR</a></div><div class="ttdeci">ISR(TIMER1_OVF_vect)</div><div class="ttdoc">Interrupt service routine for the timer which controls the alive LED and warming LED. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8c_source.html#l00123">HCU_Funcs.c:123</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a062607eaaffe8c3f8193991755e024f9"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a062607eaaffe8c3f8193991755e024f9">K_factor</a></div><div class="ttdeci">#define K_factor</div><div class="ttdoc">Assumed K factor for the flow meter in pulses per liter. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00107">HCU_Funcs.h:107</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_ad929acd64f5f96d83c219733e25e7a29"><div class="ttname"><a href="_h_c_u___funcs_8h.html#ad929acd64f5f96d83c219733e25e7a29">ECU_present</a></div><div class="ttdeci">#define ECU_present</div><div class="ttdoc">0 means the dummy ECU is present, 1 means the real ECU is present </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00056">HCU_Funcs.h:56</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a9f877a9f91f3f250db97a58abe796eb9"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a9f877a9f91f3f250db97a58abe796eb9">Warm_LED</a></div><div class="ttdeci">#define Warm_LED</div><div class="ttdoc">Pin location for the warm up LED. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00071">HCU_Funcs.h:71</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8c_html_af224025ba48225a48fc9eddc2e72150d"><div class="ttname"><a href="_h_c_u___funcs_8c.html#af224025ba48225a48fc9eddc2e72150d">change_timers</a></div><div class="ttdeci">void change_timers(void)</div><div class="ttdoc">Changes the mode of the used timers such that they can perform new functions in the pumping phase of ...</div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8c_source.html#l00424">HCU_Funcs.c:424</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_af9e36069f73b8a3642ae276fd3b672a1"><div class="ttname"><a href="_h_c_u___funcs_8h.html#af9e36069f73b8a3642ae276fd3b672a1">pulse_count</a></div><div class="ttdeci">uint8_t pulse_count</div><div class="ttdoc">Variable which will keep track of how many pulses were actually received. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00168">HCU_Funcs.h:168</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_ad188fb0fbfd923bdb01294072367d024"><div class="ttname"><a href="_h_c_u___funcs_8h.html#ad188fb0fbfd923bdb01294072367d024">bit_is_clear</a></div><div class="ttdeci">#define bit_is_clear(sfr, bit)</div><div class="ttdoc">Simple function define for testing if the bit is clear. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00024">HCU_Funcs.h:24</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a8ad8cee6932a1598468451a573827467"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a8ad8cee6932a1598468451a573827467">Fuel_LED</a></div><div class="ttdeci">#define Fuel_LED</div><div class="ttdoc">Pin location for the fuel rate LED. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00097">HCU_Funcs.h:97</a></div></div>
<div class="ttc" id="_h_c_u___funcs_8h_html_a3c89094d4fdcd1aacfb42efac1926ec4"><div class="ttname"><a href="_h_c_u___funcs_8h.html#a3c89094d4fdcd1aacfb42efac1926ec4">ECUon_Pin</a></div><div class="ttdeci">#define ECUon_Pin</div><div class="ttdoc">Pin location for I/O port that will turn on the ECU. </div><div class="ttdef"><b>Definition:</b> <a href="_h_c_u___funcs_8h_source.html#l00066">HCU_Funcs.h:66</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_7cefd84462340f3f69fc145105ef3383.html">ACES_HCU</a></li><li class="navelem"><a class="el" href="_h_c_u___funcs_8c.html">HCU_Funcs.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
